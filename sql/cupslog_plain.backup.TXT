--
-- PostgreSQL database dump
--

-- Started on 2009-05-27 14:23:38

SET client_encoding = 'UTF8';
SET standard_conforming_strings = off;
SET check_function_bodies = false;
SET client_min_messages = warning;
SET escape_string_warning = off;

--
-- TOC entry 334 (class 2612 OID 16544)
-- Name: plpgsql; Type: PROCEDURAL LANGUAGE; Schema: -; Owner: postgres
--

CREATE PROCEDURAL LANGUAGE plpgsql;


ALTER PROCEDURAL LANGUAGE plpgsql OWNER TO postgres;

SET search_path = public, pg_catalog;

--
-- TOC entry 20 (class 1255 OID 16687)
-- Dependencies: 6 334
-- Name: check_printer_perm(character varying, inet, character varying, character varying); Type: FUNCTION; Schema: public; Owner: postgres
--

CREATE FUNCTION check_printer_perm(character varying, inet, character varying, character varying) RETURNS boolean
    AS $_$
    DECLARE
        printer_id INTEGER;
    BEGIN
        printer_id := (select printers.id 
			from printers 
				INNER JOIN printers_mandat ON (printers.mandat_id = printers_mandat.id) 
				INNER JOIN rel_mandat2doc_level ON ( rel_mandat2doc_level.mandat_id =printers_mandat.id) 
				INNER JOIN document_level ON (document_level.id = rel_mandat2doc_level.doclevel_id)
			where 
				printers.printer_name=$1 and 
				printers.ip_adress=$2 and 
				printers_mandat.mandat=$3 and 
				document_level.marker=$4
			); 
        IF printer_id ISNULL THEN
            RETURN 0;
        END IF;
        RETURN 1;
    END;
$_$
    LANGUAGE plpgsql;


ALTER FUNCTION public.check_printer_perm(character varying, inet, character varying, character varying) OWNER TO postgres;

--
-- TOC entry 23 (class 1255 OID 17057)
-- Dependencies: 334 6
-- Name: get_mandat_id(character varying); Type: FUNCTION; Schema: public; Owner: postgres
--

CREATE FUNCTION get_mandat_id(character varying) RETURNS integer
    AS $_$
    DECLARE
        mandat_id INTEGER;
    BEGIN
    /*
	Получить id мандата если такого не существует,
		то провериить существование мандата "НЕ ОПРЕДЕЛЕН"
			если его нет т
				вставить в таблицу, записать сообщение в таблицу лога 
		вернуть  id найденного мандата    
    */
        mandat_id := (select id from printers_mandat where (printers_mandat.mandat=$1 OR printers_mandat.mandat='NOT FOUND')); 
        IF NOT FOUND THEN
		-- вставим в таблицу данные
		INSERT INTO printers_mandat (mandat) VALUES ('NOT FOUND');
		mandat_id := (select id from printers_mandat where (printers_mandat.mandat=$1 OR printers_mandat.mandat='NOT FOUND')); 
        END IF;
        RETURN mandat_id;
    END;
$_$
    LANGUAGE plpgsql;


ALTER FUNCTION public.get_mandat_id(character varying) OWNER TO postgres;

--
-- TOC entry 21 (class 1255 OID 16688)
-- Dependencies: 6 334
-- Name: get_user_id(character varying, character varying, character varying, character varying); Type: FUNCTION; Schema: public; Owner: postgres
--

CREATE FUNCTION get_user_id(last_n character varying, firts_n character varying, middle_n character varying, tlp character varying) RETURNS integer
    AS $_$
    DECLARE
        user_id INTEGER;
    BEGIN
    
    user_id=(SELECT id FROM users WHERE last_name=$1 and first_name=$2 and middle_name =$3);
    IF NOT FOUND THEN
	-- вставим в таблицу данные
	INSERT INTO users (last_name,first_name,middle_name,telephone) VALUES ($1,$2,$3,$4);
	user_id=(SELECT id FROM users WHERE last_name=$1 and first_name=$2 and middle_name =$3);
    END IF;
    RETURN user_id;
    
   END;$_$
    LANGUAGE plpgsql;


ALTER FUNCTION public.get_user_id(last_n character varying, firts_n character varying, middle_n character varying, tlp character varying) OWNER TO postgres;

--
-- TOC entry 22 (class 1255 OID 16822)
-- Dependencies: 334 6
-- Name: process_get_id(); Type: FUNCTION; Schema: public; Owner: postgres
--

CREATE FUNCTION process_get_id() RETURNS trigger
    AS $$
DECLARE
    pr_id INTEGER;
    fp_id INTEGER;
    BEGIN
/*
Для каждой вставленной записи в таблицу reports_info вызывается тригер, который
получает id записи из таблицы printers которой соответствует принтер с сопадающими name,ip,mandat
получает id записи из таблицы firtspages которой соответствует запись указывающая на полный путь к сохраненой первой страцнице
печатаемого документа т.е с сопадающим fp_filename
Если хотя бы один из этих параметров не определен, то запись в таблицу не вставиться
После получения этих параметров они совместно с оставшимися полями записи копируются в таблицу reports
*/    
        IF (TG_OP = 'INSERT') THEN
	    --insert into debug_log (info_str) values(NEW.printer_name);
	    pr_id :=(select printers.id 
			from printers INNER JOIN printers_mandat ON (printers.mandat_id = printers_mandat.id) 
			where printers.printer_name=NEW.printer_name and printers.ip_adress=NEW.printer_ip and printers_mandat.mandat=NEW.printer_mandat);
			
	    --insert into debug_log (info_str) values(pr_id);	
	    
	    fp_id := (select id from firstpages where fp_filename=NEW.firstpages_path); 		

	    --insert into debug_log (info_str) values(fp_id);	
	    	    
	    if  (pr_id IS NULL or fp_id IS NULL)THEN
		RETURN NULL;
	    END IF;
            INSERT INTO reports (printer_id,firstpages_id,user_fio,doc_name,mb_number,tag,page_count,page_copy,descr)
            
			VALUES  (pr_id,fp_id,NEW.user_fio,NEW.doc_name,NEW.mb_number,NEW.tag,NEW.page_count,NEW.page_copy,NEW.descr);
            RETURN NEW;
        END IF;
        RETURN NULL; -- result is ignored since this is an AFTER trigger
    END;
$$
    LANGUAGE plpgsql;


ALTER FUNCTION public.process_get_id() OWNER TO postgres;

SET default_tablespace = '';

SET default_with_oids = false;

--
-- TOC entry 1525 (class 1259 OID 16938)
-- Dependencies: 6
-- Name: add_info; Type: TABLE; Schema: public; Owner: postgres; Tablespace: 
--

CREATE TABLE add_info (
    id integer NOT NULL,
    reports_id integer NOT NULL,
    tag_key character varying(255),
    tag_value character varying(255)
);


ALTER TABLE public.add_info OWNER TO postgres;

--
-- TOC entry 1524 (class 1259 OID 16936)
-- Dependencies: 6 1525
-- Name: add_info_id_seq; Type: SEQUENCE; Schema: public; Owner: postgres
--

CREATE SEQUENCE add_info_id_seq
    START WITH 1
    INCREMENT BY 1
    NO MAXVALUE
    NO MINVALUE
    CACHE 1;


ALTER TABLE public.add_info_id_seq OWNER TO postgres;

--
-- TOC entry 1885 (class 0 OID 0)
-- Dependencies: 1524
-- Name: add_info_id_seq; Type: SEQUENCE OWNED BY; Schema: public; Owner: postgres
--

ALTER SEQUENCE add_info_id_seq OWNED BY add_info.id;


--
-- TOC entry 1886 (class 0 OID 0)
-- Dependencies: 1524
-- Name: add_info_id_seq; Type: SEQUENCE SET; Schema: public; Owner: postgres
--

SELECT pg_catalog.setval('add_info_id_seq', 1, false);


--
-- TOC entry 1507 (class 1259 OID 16705)
-- Dependencies: 1796 6
-- Name: debug_log; Type: TABLE; Schema: public; Owner: postgres; Tablespace: 
--

CREATE TABLE debug_log (
    id integer NOT NULL,
    date_time timestamp with time zone DEFAULT now(),
    info_str text
);


ALTER TABLE public.debug_log OWNER TO postgres;

--
-- TOC entry 1506 (class 1259 OID 16703)
-- Dependencies: 6 1507
-- Name: debug_log_id_seq; Type: SEQUENCE; Schema: public; Owner: postgres
--

CREATE SEQUENCE debug_log_id_seq
    START WITH 1
    INCREMENT BY 1
    NO MAXVALUE
    NO MINVALUE
    CACHE 1;


ALTER TABLE public.debug_log_id_seq OWNER TO postgres;

--
-- TOC entry 1888 (class 0 OID 0)
-- Dependencies: 1506
-- Name: debug_log_id_seq; Type: SEQUENCE OWNED BY; Schema: public; Owner: postgres
--

ALTER SEQUENCE debug_log_id_seq OWNED BY debug_log.id;


--
-- TOC entry 1889 (class 0 OID 0)
-- Dependencies: 1506
-- Name: debug_log_id_seq; Type: SEQUENCE SET; Schema: public; Owner: postgres
--

SELECT pg_catalog.setval('debug_log_id_seq', 1, false);


--
-- TOC entry 1509 (class 1259 OID 16717)
-- Dependencies: 6
-- Name: document_level; Type: TABLE; Schema: public; Owner: postgres; Tablespace: 
--

CREATE TABLE document_level (
    id integer NOT NULL,
    marker character varying(3) NOT NULL,
    ds character varying(25) NOT NULL
);


ALTER TABLE public.document_level OWNER TO postgres;

--
-- TOC entry 1890 (class 0 OID 0)
-- Dependencies: 1509
-- Name: TABLE document_level; Type: COMMENT; Schema: public; Owner: postgres
--

COMMENT ON TABLE document_level IS 'Таблица описывающая уровни секретности документов:
Не секретно
Секретно
Совершенно секретно
Особой важности';


--
-- TOC entry 1508 (class 1259 OID 16715)
-- Dependencies: 1509 6
-- Name: document_level_id_seq; Type: SEQUENCE; Schema: public; Owner: postgres
--

CREATE SEQUENCE document_level_id_seq
    INCREMENT BY 1
    NO MAXVALUE
    NO MINVALUE
    CACHE 1;


ALTER TABLE public.document_level_id_seq OWNER TO postgres;

--
-- TOC entry 1892 (class 0 OID 0)
-- Dependencies: 1508
-- Name: document_level_id_seq; Type: SEQUENCE OWNED BY; Schema: public; Owner: postgres
--

ALTER SEQUENCE document_level_id_seq OWNED BY document_level.id;


--
-- TOC entry 1893 (class 0 OID 0)
-- Dependencies: 1508
-- Name: document_level_id_seq; Type: SEQUENCE SET; Schema: public; Owner: postgres
--

SELECT pg_catalog.setval('document_level_id_seq', 5, true);


--
-- TOC entry 1513 (class 1259 OID 16801)
-- Dependencies: 6
-- Name: executors; Type: TABLE; Schema: public; Owner: postgres; Tablespace: 
--

CREATE TABLE executors (
    id integer NOT NULL,
    last_name character varying(55),
    first_name character varying(55),
    middle_name character varying(55),
    telephone character varying(13)
);


ALTER TABLE public.executors OWNER TO postgres;

--
-- TOC entry 1511 (class 1259 OID 16725)
-- Dependencies: 6
-- Name: firstpages; Type: TABLE; Schema: public; Owner: postgres; Tablespace: 
--

CREATE TABLE firstpages (
    id integer NOT NULL,
    fp_filename character varying(255) NOT NULL
);


ALTER TABLE public.firstpages OWNER TO postgres;

--
-- TOC entry 1510 (class 1259 OID 16723)
-- Dependencies: 1511 6
-- Name: firstpages_id_seq; Type: SEQUENCE; Schema: public; Owner: postgres
--

CREATE SEQUENCE firstpages_id_seq
    START WITH 1
    INCREMENT BY 1
    NO MAXVALUE
    NO MINVALUE
    CACHE 1;


ALTER TABLE public.firstpages_id_seq OWNER TO postgres;

--
-- TOC entry 1896 (class 0 OID 0)
-- Dependencies: 1510
-- Name: firstpages_id_seq; Type: SEQUENCE OWNED BY; Schema: public; Owner: postgres
--

ALTER SEQUENCE firstpages_id_seq OWNED BY firstpages.id;


--
-- TOC entry 1897 (class 0 OID 0)
-- Dependencies: 1510
-- Name: firstpages_id_seq; Type: SEQUENCE SET; Schema: public; Owner: postgres
--

SELECT pg_catalog.setval('firstpages_id_seq', 1, false);


--
-- TOC entry 1517 (class 1259 OID 16837)
-- Dependencies: 1802 6
-- Name: input; Type: TABLE; Schema: public; Owner: postgres; Tablespace: 
--

CREATE TABLE input (
    id integer NOT NULL,
    printer_name character varying(255) NOT NULL,
    printer_mandat character varying(255) NOT NULL,
    firstpages_path character varying(255) NOT NULL,
    user_fio character varying(55) NOT NULL,
    doc_name character varying(255) NOT NULL,
    date_created timestamp with time zone DEFAULT now() NOT NULL,
    mb_number character varying(15) NOT NULL,
    doc_level character varying(55) NOT NULL,
    page_count integer NOT NULL,
    page_copy integer NOT NULL,
    descr text,
    printer_ip inet,
    executor_first character varying(55)[],
    executor_middle character varying(55)[],
    executor_last character varying(55)[],
    executor_phone character(16)
);


ALTER TABLE public.input OWNER TO postgres;

--
-- TOC entry 1898 (class 0 OID 0)
-- Dependencies: 1517
-- Name: TABLE input; Type: COMMENT; Schema: public; Owner: postgres
--

COMMENT ON TABLE input IS 'На вставку каждой записи срабатывает триггер который получает printer_id firstpages_id и записывает в таблицу reports все остальные данные';


--
-- TOC entry 1899 (class 0 OID 0)
-- Dependencies: 1517
-- Name: COLUMN input.user_fio; Type: COMMENT; Schema: public; Owner: postgres
--

COMMENT ON COLUMN input.user_fio IS 'То что получаем от сервреа печати  в фильтр';


--
-- TOC entry 1900 (class 0 OID 0)
-- Dependencies: 1517
-- Name: COLUMN input.executor_first; Type: COMMENT; Schema: public; Owner: postgres
--

COMMENT ON COLUMN input.executor_first IS 'Имя исполнителя документа';


--
-- TOC entry 1515 (class 1259 OID 16812)
-- Dependencies: 6
-- Name: list_recivers; Type: TABLE; Schema: public; Owner: postgres; Tablespace: 
--

CREATE TABLE list_recivers (
    id integer NOT NULL,
    adress character varying(255)
);


ALTER TABLE public.list_recivers OWNER TO postgres;

--
-- TOC entry 1514 (class 1259 OID 16810)
-- Dependencies: 6 1515
-- Name: list_recivers_id_seq; Type: SEQUENCE; Schema: public; Owner: postgres
--

CREATE SEQUENCE list_recivers_id_seq
    START WITH 1
    INCREMENT BY 1
    NO MAXVALUE
    NO MINVALUE
    CACHE 1;


ALTER TABLE public.list_recivers_id_seq OWNER TO postgres;

--
-- TOC entry 1903 (class 0 OID 0)
-- Dependencies: 1514
-- Name: list_recivers_id_seq; Type: SEQUENCE OWNED BY; Schema: public; Owner: postgres
--

ALTER SEQUENCE list_recivers_id_seq OWNED BY list_recivers.id;


--
-- TOC entry 1904 (class 0 OID 0)
-- Dependencies: 1514
-- Name: list_recivers_id_seq; Type: SEQUENCE SET; Schema: public; Owner: postgres
--

SELECT pg_catalog.setval('list_recivers_id_seq', 1, false);


--
-- TOC entry 1521 (class 1259 OID 16877)
-- Dependencies: 1805 6
-- Name: printers; Type: TABLE; Schema: public; Owner: postgres; Tablespace: 
--

CREATE TABLE printers (
    id integer NOT NULL,
    mandat_id integer NOT NULL,
    printer_name character varying(255) NOT NULL,
    date_created timestamp with time zone DEFAULT now() NOT NULL,
    descr text,
    ip_adress inet,
    ps character varying(255)
);


ALTER TABLE public.printers OWNER TO postgres;

--
-- TOC entry 1520 (class 1259 OID 16875)
-- Dependencies: 1521 6
-- Name: printers_id_seq; Type: SEQUENCE; Schema: public; Owner: postgres
--

CREATE SEQUENCE printers_id_seq
    START WITH 1
    INCREMENT BY 1
    NO MAXVALUE
    NO MINVALUE
    CACHE 1;


ALTER TABLE public.printers_id_seq OWNER TO postgres;

--
-- TOC entry 1906 (class 0 OID 0)
-- Dependencies: 1520
-- Name: printers_id_seq; Type: SEQUENCE OWNED BY; Schema: public; Owner: postgres
--

ALTER SEQUENCE printers_id_seq OWNED BY printers.id;


--
-- TOC entry 1907 (class 0 OID 0)
-- Dependencies: 1520
-- Name: printers_id_seq; Type: SEQUENCE SET; Schema: public; Owner: postgres
--

SELECT pg_catalog.setval('printers_id_seq', 1, false);


--
-- TOC entry 1519 (class 1259 OID 16869)
-- Dependencies: 6
-- Name: printers_mandat; Type: TABLE; Schema: public; Owner: postgres; Tablespace: 
--

CREATE TABLE printers_mandat (
    id integer NOT NULL,
    mandat character varying(25)
);


ALTER TABLE public.printers_mandat OWNER TO postgres;

--
-- TOC entry 1908 (class 0 OID 0)
-- Dependencies: 1519
-- Name: TABLE printers_mandat; Type: COMMENT; Schema: public; Owner: postgres
--

COMMENT ON TABLE printers_mandat IS 'Таблица описывающая соотношения грифа документа и мандата принтера';


--
-- TOC entry 1518 (class 1259 OID 16867)
-- Dependencies: 1519 6
-- Name: printers_mandat_id_seq; Type: SEQUENCE; Schema: public; Owner: postgres
--

CREATE SEQUENCE printers_mandat_id_seq
    INCREMENT BY 1
    NO MAXVALUE
    NO MINVALUE
    CACHE 1;


ALTER TABLE public.printers_mandat_id_seq OWNER TO postgres;

--
-- TOC entry 1910 (class 0 OID 0)
-- Dependencies: 1518
-- Name: printers_mandat_id_seq; Type: SEQUENCE OWNED BY; Schema: public; Owner: postgres
--

ALTER SEQUENCE printers_mandat_id_seq OWNED BY printers_mandat.id;


--
-- TOC entry 1911 (class 0 OID 0)
-- Dependencies: 1518
-- Name: printers_mandat_id_seq; Type: SEQUENCE SET; Schema: public; Owner: postgres
--

SELECT pg_catalog.setval('printers_mandat_id_seq', 9, true);


--
-- TOC entry 1527 (class 1259 OID 17016)
-- Dependencies: 6
-- Name: rel_add_info2reports; Type: TABLE; Schema: public; Owner: postgres; Tablespace: 
--

CREATE TABLE rel_add_info2reports (
    add_info_id integer NOT NULL,
    reports_id integer NOT NULL
);


ALTER TABLE public.rel_add_info2reports OWNER TO postgres;

--
-- TOC entry 1528 (class 1259 OID 17037)
-- Dependencies: 6
-- Name: rel_list_recivers2reports; Type: TABLE; Schema: public; Owner: postgres; Tablespace: 
--

CREATE TABLE rel_list_recivers2reports (
    list_recivers_id integer NOT NULL,
    reports_id integer NOT NULL
);


ALTER TABLE public.rel_list_recivers2reports OWNER TO postgres;

--
-- TOC entry 1526 (class 1259 OID 16957)
-- Dependencies: 6
-- Name: rel_mandat2doc_level; Type: TABLE; Schema: public; Owner: postgres; Tablespace: 
--

CREATE TABLE rel_mandat2doc_level (
    mandat_id integer NOT NULL,
    doclevel_id integer NOT NULL
);


ALTER TABLE public.rel_mandat2doc_level OWNER TO postgres;

--
-- TOC entry 1914 (class 0 OID 0)
-- Dependencies: 1526
-- Name: TABLE rel_mandat2doc_level; Type: COMMENT; Schema: public; Owner: postgres
--

COMMENT ON TABLE rel_mandat2doc_level IS 'Связь между мандатом принтера и разрешенными к печати уровнями документов';


--
-- TOC entry 1523 (class 1259 OID 16908)
-- Dependencies: 1807 6
-- Name: reports; Type: TABLE; Schema: public; Owner: postgres; Tablespace: 
--

CREATE TABLE reports (
    id integer NOT NULL,
    printer_id integer NOT NULL,
    firstpages_id integer NOT NULL,
    user_id integer NOT NULL,
    copy_number integer NOT NULL,
    doc_level_id integer NOT NULL,
    doc_name character varying(255) NOT NULL,
    date_created timestamp with time zone DEFAULT now() NOT NULL,
    mb_number character varying(15) NOT NULL,
    page_count integer NOT NULL,
    page_copy integer NOT NULL,
    descr text,
    cups_user character varying(55)[],
    status character varying(15)
);


ALTER TABLE public.reports OWNER TO postgres;

--
-- TOC entry 1522 (class 1259 OID 16906)
-- Dependencies: 1523 6
-- Name: reports_id_seq; Type: SEQUENCE; Schema: public; Owner: postgres
--

CREATE SEQUENCE reports_id_seq
    START WITH 1
    INCREMENT BY 1
    NO MAXVALUE
    NO MINVALUE
    CACHE 1;


ALTER TABLE public.reports_id_seq OWNER TO postgres;

--
-- TOC entry 1917 (class 0 OID 0)
-- Dependencies: 1522
-- Name: reports_id_seq; Type: SEQUENCE OWNED BY; Schema: public; Owner: postgres
--

ALTER SEQUENCE reports_id_seq OWNED BY reports.id;


--
-- TOC entry 1918 (class 0 OID 0)
-- Dependencies: 1522
-- Name: reports_id_seq; Type: SEQUENCE SET; Schema: public; Owner: postgres
--

SELECT pg_catalog.setval('reports_id_seq', 1, false);


--
-- TOC entry 1516 (class 1259 OID 16835)
-- Dependencies: 6 1517
-- Name: reports_info_id_seq; Type: SEQUENCE; Schema: public; Owner: postgres
--

CREATE SEQUENCE reports_info_id_seq
    START WITH 1
    INCREMENT BY 1
    NO MAXVALUE
    NO MINVALUE
    CACHE 1;


ALTER TABLE public.reports_info_id_seq OWNER TO postgres;

--
-- TOC entry 1919 (class 0 OID 0)
-- Dependencies: 1516
-- Name: reports_info_id_seq; Type: SEQUENCE OWNED BY; Schema: public; Owner: postgres
--

ALTER SEQUENCE reports_info_id_seq OWNED BY input.id;


--
-- TOC entry 1920 (class 0 OID 0)
-- Dependencies: 1516
-- Name: reports_info_id_seq; Type: SEQUENCE SET; Schema: public; Owner: postgres
--

SELECT pg_catalog.setval('reports_info_id_seq', 1, false);


--
-- TOC entry 1512 (class 1259 OID 16799)
-- Dependencies: 1513 6
-- Name: users_id_seq; Type: SEQUENCE; Schema: public; Owner: postgres
--

CREATE SEQUENCE users_id_seq
    START WITH 1
    INCREMENT BY 1
    NO MAXVALUE
    NO MINVALUE
    CACHE 1;


ALTER TABLE public.users_id_seq OWNER TO postgres;

--
-- TOC entry 1921 (class 0 OID 0)
-- Dependencies: 1512
-- Name: users_id_seq; Type: SEQUENCE OWNED BY; Schema: public; Owner: postgres
--

ALTER SEQUENCE users_id_seq OWNED BY executors.id;


--
-- TOC entry 1922 (class 0 OID 0)
-- Dependencies: 1512
-- Name: users_id_seq; Type: SEQUENCE SET; Schema: public; Owner: postgres
--

SELECT pg_catalog.setval('users_id_seq', 1, false);


--
-- TOC entry 1808 (class 2604 OID 16941)
-- Dependencies: 1525 1524 1525
-- Name: id; Type: DEFAULT; Schema: public; Owner: postgres
--

ALTER TABLE add_info ALTER COLUMN id SET DEFAULT nextval('add_info_id_seq'::regclass);


--
-- TOC entry 1795 (class 2604 OID 16708)
-- Dependencies: 1507 1506 1507
-- Name: id; Type: DEFAULT; Schema: public; Owner: postgres
--

ALTER TABLE debug_log ALTER COLUMN id SET DEFAULT nextval('debug_log_id_seq'::regclass);


--
-- TOC entry 1797 (class 2604 OID 16720)
-- Dependencies: 1508 1509 1509
-- Name: id; Type: DEFAULT; Schema: public; Owner: postgres
--

ALTER TABLE document_level ALTER COLUMN id SET DEFAULT nextval('document_level_id_seq'::regclass);


--
-- TOC entry 1799 (class 2604 OID 16804)
-- Dependencies: 1512 1513 1513
-- Name: id; Type: DEFAULT; Schema: public; Owner: postgres
--

ALTER TABLE executors ALTER COLUMN id SET DEFAULT nextval('users_id_seq'::regclass);


--
-- TOC entry 1798 (class 2604 OID 16728)
-- Dependencies: 1510 1511 1511
-- Name: id; Type: DEFAULT; Schema: public; Owner: postgres
--

ALTER TABLE firstpages ALTER COLUMN id SET DEFAULT nextval('firstpages_id_seq'::regclass);


--
-- TOC entry 1801 (class 2604 OID 16840)
-- Dependencies: 1516 1517 1517
-- Name: id; Type: DEFAULT; Schema: public; Owner: postgres
--

ALTER TABLE input ALTER COLUMN id SET DEFAULT nextval('reports_info_id_seq'::regclass);


--
-- TOC entry 1800 (class 2604 OID 16815)
-- Dependencies: 1515 1514 1515
-- Name: id; Type: DEFAULT; Schema: public; Owner: postgres
--

ALTER TABLE list_recivers ALTER COLUMN id SET DEFAULT nextval('list_recivers_id_seq'::regclass);


--
-- TOC entry 1804 (class 2604 OID 16880)
-- Dependencies: 1521 1520 1521
-- Name: id; Type: DEFAULT; Schema: public; Owner: postgres
--

ALTER TABLE printers ALTER COLUMN id SET DEFAULT nextval('printers_id_seq'::regclass);


--
-- TOC entry 1803 (class 2604 OID 16872)
-- Dependencies: 1519 1518 1519
-- Name: id; Type: DEFAULT; Schema: public; Owner: postgres
--

ALTER TABLE printers_mandat ALTER COLUMN id SET DEFAULT nextval('printers_mandat_id_seq'::regclass);


--
-- TOC entry 1806 (class 2604 OID 16911)
-- Dependencies: 1523 1522 1523
-- Name: id; Type: DEFAULT; Schema: public; Owner: postgres
--

ALTER TABLE reports ALTER COLUMN id SET DEFAULT nextval('reports_id_seq'::regclass);


--
-- TOC entry 1875 (class 0 OID 16938)
-- Dependencies: 1525
-- Data for Name: add_info; Type: TABLE DATA; Schema: public; Owner: postgres
--



--
-- TOC entry 1866 (class 0 OID 16705)
-- Dependencies: 1507
-- Data for Name: debug_log; Type: TABLE DATA; Schema: public; Owner: postgres
--



--
-- TOC entry 1867 (class 0 OID 16717)
-- Dependencies: 1509
-- Data for Name: document_level; Type: TABLE DATA; Schema: public; Owner: postgres
--

INSERT INTO document_level (id, marker, ds) VALUES (1, 'НУ', 'Не установленно');
INSERT INTO document_level (id, marker, ds) VALUES (2, 'НС', 'Не секретно');
INSERT INTO document_level (id, marker, ds) VALUES (3, 'С', 'Секретно');
INSERT INTO document_level (id, marker, ds) VALUES (4, 'СС', 'Совершенно секретно');
INSERT INTO document_level (id, marker, ds) VALUES (5, 'ОВ', 'Особой важности');


--
-- TOC entry 1869 (class 0 OID 16801)
-- Dependencies: 1513
-- Data for Name: executors; Type: TABLE DATA; Schema: public; Owner: postgres
--



--
-- TOC entry 1868 (class 0 OID 16725)
-- Dependencies: 1511
-- Data for Name: firstpages; Type: TABLE DATA; Schema: public; Owner: postgres
--



--
-- TOC entry 1871 (class 0 OID 16837)
-- Dependencies: 1517
-- Data for Name: input; Type: TABLE DATA; Schema: public; Owner: postgres
--



--
-- TOC entry 1870 (class 0 OID 16812)
-- Dependencies: 1515
-- Data for Name: list_recivers; Type: TABLE DATA; Schema: public; Owner: postgres
--



--
-- TOC entry 1873 (class 0 OID 16877)
-- Dependencies: 1521
-- Data for Name: printers; Type: TABLE DATA; Schema: public; Owner: postgres
--



--
-- TOC entry 1872 (class 0 OID 16869)
-- Dependencies: 1519
-- Data for Name: printers_mandat; Type: TABLE DATA; Schema: public; Owner: postgres
--

INSERT INTO printers_mandat (id, mandat) VALUES (8, 'NOT FOUND');


--
-- TOC entry 1877 (class 0 OID 17016)
-- Dependencies: 1527
-- Data for Name: rel_add_info2reports; Type: TABLE DATA; Schema: public; Owner: postgres
--



--
-- TOC entry 1878 (class 0 OID 17037)
-- Dependencies: 1528
-- Data for Name: rel_list_recivers2reports; Type: TABLE DATA; Schema: public; Owner: postgres
--



--
-- TOC entry 1876 (class 0 OID 16957)
-- Dependencies: 1526
-- Data for Name: rel_mandat2doc_level; Type: TABLE DATA; Schema: public; Owner: postgres
--



--
-- TOC entry 1874 (class 0 OID 16908)
-- Dependencies: 1523
-- Data for Name: reports; Type: TABLE DATA; Schema: public; Owner: postgres
--



--
-- TOC entry 1843 (class 2606 OID 16961)
-- Dependencies: 1526 1526 1526
-- Name: PK; Type: CONSTRAINT; Schema: public; Owner: postgres; Tablespace: 
--

ALTER TABLE ONLY rel_mandat2doc_level
    ADD CONSTRAINT "PK" PRIMARY KEY (mandat_id, doclevel_id);


--
-- TOC entry 1847 (class 2606 OID 17027)
-- Dependencies: 1527 1527 1527
-- Name: PK_add_info2reports; Type: CONSTRAINT; Schema: public; Owner: postgres; Tablespace: 
--

ALTER TABLE ONLY rel_add_info2reports
    ADD CONSTRAINT "PK_add_info2reports" PRIMARY KEY (add_info_id, reports_id);


--
-- TOC entry 1851 (class 2606 OID 17041)
-- Dependencies: 1528 1528 1528
-- Name: PK_list_recivers2reports; Type: CONSTRAINT; Schema: public; Owner: postgres; Tablespace: 
--

ALTER TABLE ONLY rel_list_recivers2reports
    ADD CONSTRAINT "PK_list_recivers2reports" PRIMARY KEY (list_recivers_id, reports_id);


--
-- TOC entry 1820 (class 2606 OID 16956)
-- Dependencies: 1515 1515
-- Name: PX_adress; Type: CONSTRAINT; Schema: public; Owner: postgres; Tablespace: 
--

ALTER TABLE ONLY list_recivers
    ADD CONSTRAINT "PX_adress" UNIQUE (adress);


--
-- TOC entry 1816 (class 2606 OID 16808)
-- Dependencies: 1513 1513 1513 1513
-- Name: PX_fio; Type: CONSTRAINT; Schema: public; Owner: postgres; Tablespace: 
--

ALTER TABLE ONLY executors
    ADD CONSTRAINT "PX_fio" UNIQUE (last_name, first_name, middle_name);


--
-- TOC entry 1839 (class 2606 OID 16948)
-- Dependencies: 1525 1525 1525
-- Name: PX_key_value; Type: CONSTRAINT; Schema: public; Owner: postgres; Tablespace: 
--

ALTER TABLE ONLY add_info
    ADD CONSTRAINT "PX_key_value" UNIQUE (tag_key, tag_value);


--
-- TOC entry 1826 (class 2606 OID 16974)
-- Dependencies: 1519 1519
-- Name: PX_mandat; Type: CONSTRAINT; Schema: public; Owner: postgres; Tablespace: 
--

ALTER TABLE ONLY printers_mandat
    ADD CONSTRAINT "PX_mandat" UNIQUE (mandat);


--
-- TOC entry 1841 (class 2606 OID 16946)
-- Dependencies: 1525 1525
-- Name: add_info_pkey; Type: CONSTRAINT; Schema: public; Owner: postgres; Tablespace: 
--

ALTER TABLE ONLY add_info
    ADD CONSTRAINT add_info_pkey PRIMARY KEY (id);


--
-- TOC entry 1810 (class 2606 OID 16714)
-- Dependencies: 1507 1507
-- Name: debug_log_pkey; Type: CONSTRAINT; Schema: public; Owner: postgres; Tablespace: 
--

ALTER TABLE ONLY debug_log
    ADD CONSTRAINT debug_log_pkey PRIMARY KEY (id);


--
-- TOC entry 1812 (class 2606 OID 16722)
-- Dependencies: 1509 1509
-- Name: document_level_pkey; Type: CONSTRAINT; Schema: public; Owner: postgres; Tablespace: 
--

ALTER TABLE ONLY document_level
    ADD CONSTRAINT document_level_pkey PRIMARY KEY (id);


--
-- TOC entry 1814 (class 2606 OID 16730)
-- Dependencies: 1511 1511
-- Name: firstpages_pkey; Type: CONSTRAINT; Schema: public; Owner: postgres; Tablespace: 
--

ALTER TABLE ONLY firstpages
    ADD CONSTRAINT firstpages_pkey PRIMARY KEY (id);


--
-- TOC entry 1822 (class 2606 OID 16817)
-- Dependencies: 1515 1515
-- Name: list_recivers_pkey; Type: CONSTRAINT; Schema: public; Owner: postgres; Tablespace: 
--

ALTER TABLE ONLY list_recivers
    ADD CONSTRAINT list_recivers_pkey PRIMARY KEY (id);


--
-- TOC entry 1828 (class 2606 OID 16874)
-- Dependencies: 1519 1519
-- Name: printers_mandat_pkey; Type: CONSTRAINT; Schema: public; Owner: postgres; Tablespace: 
--

ALTER TABLE ONLY printers_mandat
    ADD CONSTRAINT printers_mandat_pkey PRIMARY KEY (id);


--
-- TOC entry 1831 (class 2606 OID 16886)
-- Dependencies: 1521 1521
-- Name: printers_pkey; Type: CONSTRAINT; Schema: public; Owner: postgres; Tablespace: 
--

ALTER TABLE ONLY printers
    ADD CONSTRAINT printers_pkey PRIMARY KEY (id);


--
-- TOC entry 1824 (class 2606 OID 16846)
-- Dependencies: 1517 1517
-- Name: reports_info_pkey; Type: CONSTRAINT; Schema: public; Owner: postgres; Tablespace: 
--

ALTER TABLE ONLY input
    ADD CONSTRAINT reports_info_pkey PRIMARY KEY (id);


--
-- TOC entry 1836 (class 2606 OID 16917)
-- Dependencies: 1523 1523
-- Name: reports_pkey; Type: CONSTRAINT; Schema: public; Owner: postgres; Tablespace: 
--

ALTER TABLE ONLY reports
    ADD CONSTRAINT reports_pkey PRIMARY KEY (id);


--
-- TOC entry 1818 (class 2606 OID 16806)
-- Dependencies: 1513 1513
-- Name: users_pkey; Type: CONSTRAINT; Schema: public; Owner: postgres; Tablespace: 
--

ALTER TABLE ONLY executors
    ADD CONSTRAINT users_pkey PRIMARY KEY (id);


--
-- TOC entry 1832 (class 1259 OID 16933)
-- Dependencies: 1523
-- Name: FKI_firstpages; Type: INDEX; Schema: public; Owner: postgres; Tablespace: 
--

CREATE INDEX "FKI_firstpages" ON reports USING btree (firstpages_id);


--
-- TOC entry 1829 (class 1259 OID 16892)
-- Dependencies: 1521
-- Name: FKI_mandat; Type: INDEX; Schema: public; Owner: postgres; Tablespace: 
--

CREATE INDEX "FKI_mandat" ON printers USING btree (mandat_id);


--
-- TOC entry 1833 (class 1259 OID 16934)
-- Dependencies: 1523
-- Name: FKI_printers; Type: INDEX; Schema: public; Owner: postgres; Tablespace: 
--

CREATE INDEX "FKI_printers" ON reports USING btree (printer_id);


--
-- TOC entry 1837 (class 1259 OID 16954)
-- Dependencies: 1525
-- Name: FKI_reports; Type: INDEX; Schema: public; Owner: postgres; Tablespace: 
--

CREATE INDEX "FKI_reports" ON add_info USING btree (reports_id);


--
-- TOC entry 1834 (class 1259 OID 16935)
-- Dependencies: 1523
-- Name: FKI_users; Type: INDEX; Schema: public; Owner: postgres; Tablespace: 
--

CREATE INDEX "FKI_users" ON reports USING btree (user_id);


--
-- TOC entry 1852 (class 1259 OID 17052)
-- Dependencies: 1528
-- Name: fki2list_recivers; Type: INDEX; Schema: public; Owner: postgres; Tablespace: 
--

CREATE INDEX fki2list_recivers ON rel_list_recivers2reports USING btree (list_recivers_id);


--
-- TOC entry 1853 (class 1259 OID 17053)
-- Dependencies: 1528
-- Name: fki2reports; Type: INDEX; Schema: public; Owner: postgres; Tablespace: 
--

CREATE INDEX fki2reports ON rel_list_recivers2reports USING btree (reports_id);


--
-- TOC entry 1848 (class 1259 OID 17034)
-- Dependencies: 1527
-- Name: fki_KF_add_info; Type: INDEX; Schema: public; Owner: postgres; Tablespace: 
--

CREATE INDEX "fki_KF_add_info" ON rel_add_info2reports USING btree (add_info_id);


--
-- TOC entry 1844 (class 1259 OID 17036)
-- Dependencies: 1526
-- Name: fki_KF_doc_level; Type: INDEX; Schema: public; Owner: postgres; Tablespace: 
--

CREATE INDEX "fki_KF_doc_level" ON rel_mandat2doc_level USING btree (doclevel_id);


--
-- TOC entry 1845 (class 1259 OID 17035)
-- Dependencies: 1526
-- Name: fki_KF_mandat; Type: INDEX; Schema: public; Owner: postgres; Tablespace: 
--

CREATE INDEX "fki_KF_mandat" ON rel_mandat2doc_level USING btree (mandat_id);


--
-- TOC entry 1849 (class 1259 OID 17033)
-- Dependencies: 1527
-- Name: fki_KF_reports; Type: INDEX; Schema: public; Owner: postgres; Tablespace: 
--

CREATE INDEX "fki_KF_reports" ON rel_add_info2reports USING btree (reports_id);


--
-- TOC entry 1865 (class 2620 OID 16848)
-- Dependencies: 22 1517
-- Name: get_id; Type: TRIGGER; Schema: public; Owner: postgres
--

CREATE TRIGGER get_id
    AFTER INSERT ON input
    FOR EACH ROW
    EXECUTE PROCEDURE process_get_id();


--
-- TOC entry 1861 (class 2606 OID 17021)
-- Dependencies: 1527 1840 1525
-- Name: FK_add_info; Type: FK CONSTRAINT; Schema: public; Owner: postgres
--

ALTER TABLE ONLY rel_add_info2reports
    ADD CONSTRAINT "FK_add_info" FOREIGN KEY (add_info_id) REFERENCES add_info(id);


--
-- TOC entry 1859 (class 2606 OID 16962)
-- Dependencies: 1509 1526 1811
-- Name: FK_doclevel; Type: FK CONSTRAINT; Schema: public; Owner: postgres
--

ALTER TABLE ONLY rel_mandat2doc_level
    ADD CONSTRAINT "FK_doclevel" FOREIGN KEY (doclevel_id) REFERENCES document_level(id);


--
-- TOC entry 1855 (class 2606 OID 16918)
-- Dependencies: 1511 1813 1523
-- Name: FK_firstpages; Type: FK CONSTRAINT; Schema: public; Owner: postgres
--

ALTER TABLE ONLY reports
    ADD CONSTRAINT "FK_firstpages" FOREIGN KEY (firstpages_id) REFERENCES firstpages(id);


--
-- TOC entry 1863 (class 2606 OID 17042)
-- Dependencies: 1515 1821 1528
-- Name: FK_list_recivers; Type: FK CONSTRAINT; Schema: public; Owner: postgres
--

ALTER TABLE ONLY rel_list_recivers2reports
    ADD CONSTRAINT "FK_list_recivers" FOREIGN KEY (list_recivers_id) REFERENCES list_recivers(id);


--
-- TOC entry 1854 (class 2606 OID 16887)
-- Dependencies: 1519 1521 1827
-- Name: FK_mandat; Type: FK CONSTRAINT; Schema: public; Owner: postgres
--

ALTER TABLE ONLY printers
    ADD CONSTRAINT "FK_mandat" FOREIGN KEY (mandat_id) REFERENCES printers_mandat(id);


--
-- TOC entry 1860 (class 2606 OID 16967)
-- Dependencies: 1526 1519 1827
-- Name: FK_mandat; Type: FK CONSTRAINT; Schema: public; Owner: postgres
--

ALTER TABLE ONLY rel_mandat2doc_level
    ADD CONSTRAINT "FK_mandat" FOREIGN KEY (mandat_id) REFERENCES printers_mandat(id);


--
-- TOC entry 1856 (class 2606 OID 16923)
-- Dependencies: 1830 1521 1523
-- Name: FK_printers; Type: FK CONSTRAINT; Schema: public; Owner: postgres
--

ALTER TABLE ONLY reports
    ADD CONSTRAINT "FK_printers" FOREIGN KEY (printer_id) REFERENCES printers(id);


--
-- TOC entry 1858 (class 2606 OID 16949)
-- Dependencies: 1525 1835 1523
-- Name: FK_reports; Type: FK CONSTRAINT; Schema: public; Owner: postgres
--

ALTER TABLE ONLY add_info
    ADD CONSTRAINT "FK_reports" FOREIGN KEY (reports_id) REFERENCES reports(id);


--
-- TOC entry 1857 (class 2606 OID 16928)
-- Dependencies: 1817 1523 1513
-- Name: FK_users; Type: FK CONSTRAINT; Schema: public; Owner: postgres
--

ALTER TABLE ONLY reports
    ADD CONSTRAINT "FK_users" FOREIGN KEY (user_id) REFERENCES executors(id);


--
-- TOC entry 1862 (class 2606 OID 17028)
-- Dependencies: 1523 1527 1835
-- Name: KF_reports; Type: FK CONSTRAINT; Schema: public; Owner: postgres
--

ALTER TABLE ONLY rel_add_info2reports
    ADD CONSTRAINT "KF_reports" FOREIGN KEY (reports_id) REFERENCES reports(id);


--
-- TOC entry 1864 (class 2606 OID 17047)
-- Dependencies: 1528 1523 1835
-- Name: KF_reports; Type: FK CONSTRAINT; Schema: public; Owner: postgres
--

ALTER TABLE ONLY rel_list_recivers2reports
    ADD CONSTRAINT "KF_reports" FOREIGN KEY (reports_id) REFERENCES reports(id);


--
-- TOC entry 1883 (class 0 OID 0)
-- Dependencies: 6
-- Name: public; Type: ACL; Schema: -; Owner: postgres
--

REVOKE ALL ON SCHEMA public FROM PUBLIC;
REVOKE ALL ON SCHEMA public FROM postgres;
GRANT ALL ON SCHEMA public TO postgres;
GRANT ALL ON SCHEMA public TO PUBLIC;


--
-- TOC entry 1884 (class 0 OID 0)
-- Dependencies: 1525
-- Name: add_info; Type: ACL; Schema: public; Owner: postgres
--

REVOKE ALL ON TABLE add_info FROM PUBLIC;
REVOKE ALL ON TABLE add_info FROM postgres;
GRANT ALL ON TABLE add_info TO postgres;


--
-- TOC entry 1887 (class 0 OID 0)
-- Dependencies: 1507
-- Name: debug_log; Type: ACL; Schema: public; Owner: postgres
--

REVOKE ALL ON TABLE debug_log FROM PUBLIC;
REVOKE ALL ON TABLE debug_log FROM postgres;
GRANT ALL ON TABLE debug_log TO postgres;


--
-- TOC entry 1891 (class 0 OID 0)
-- Dependencies: 1509
-- Name: document_level; Type: ACL; Schema: public; Owner: postgres
--

REVOKE ALL ON TABLE document_level FROM PUBLIC;
REVOKE ALL ON TABLE document_level FROM postgres;
GRANT ALL ON TABLE document_level TO postgres;


--
-- TOC entry 1894 (class 0 OID 0)
-- Dependencies: 1513
-- Name: executors; Type: ACL; Schema: public; Owner: postgres
--

REVOKE ALL ON TABLE executors FROM PUBLIC;
REVOKE ALL ON TABLE executors FROM postgres;
GRANT ALL ON TABLE executors TO postgres;


--
-- TOC entry 1895 (class 0 OID 0)
-- Dependencies: 1511
-- Name: firstpages; Type: ACL; Schema: public; Owner: postgres
--

REVOKE ALL ON TABLE firstpages FROM PUBLIC;
REVOKE ALL ON TABLE firstpages FROM postgres;
GRANT ALL ON TABLE firstpages TO postgres;


--
-- TOC entry 1901 (class 0 OID 0)
-- Dependencies: 1517
-- Name: input; Type: ACL; Schema: public; Owner: postgres
--

REVOKE ALL ON TABLE input FROM PUBLIC;
REVOKE ALL ON TABLE input FROM postgres;
GRANT ALL ON TABLE input TO postgres;


--
-- TOC entry 1902 (class 0 OID 0)
-- Dependencies: 1515
-- Name: list_recivers; Type: ACL; Schema: public; Owner: postgres
--

REVOKE ALL ON TABLE list_recivers FROM PUBLIC;
REVOKE ALL ON TABLE list_recivers FROM postgres;
GRANT ALL ON TABLE list_recivers TO postgres;


--
-- TOC entry 1905 (class 0 OID 0)
-- Dependencies: 1521
-- Name: printers; Type: ACL; Schema: public; Owner: postgres
--

REVOKE ALL ON TABLE printers FROM PUBLIC;
REVOKE ALL ON TABLE printers FROM postgres;
GRANT ALL ON TABLE printers TO postgres;


--
-- TOC entry 1909 (class 0 OID 0)
-- Dependencies: 1519
-- Name: printers_mandat; Type: ACL; Schema: public; Owner: postgres
--

REVOKE ALL ON TABLE printers_mandat FROM PUBLIC;
REVOKE ALL ON TABLE printers_mandat FROM postgres;
GRANT ALL ON TABLE printers_mandat TO postgres;


--
-- TOC entry 1912 (class 0 OID 0)
-- Dependencies: 1527
-- Name: rel_add_info2reports; Type: ACL; Schema: public; Owner: postgres
--

REVOKE ALL ON TABLE rel_add_info2reports FROM PUBLIC;
REVOKE ALL ON TABLE rel_add_info2reports FROM postgres;
GRANT ALL ON TABLE rel_add_info2reports TO postgres;


--
-- TOC entry 1913 (class 0 OID 0)
-- Dependencies: 1528
-- Name: rel_list_recivers2reports; Type: ACL; Schema: public; Owner: postgres
--

REVOKE ALL ON TABLE rel_list_recivers2reports FROM PUBLIC;
REVOKE ALL ON TABLE rel_list_recivers2reports FROM postgres;
GRANT ALL ON TABLE rel_list_recivers2reports TO postgres;


--
-- TOC entry 1915 (class 0 OID 0)
-- Dependencies: 1526
-- Name: rel_mandat2doc_level; Type: ACL; Schema: public; Owner: postgres
--

REVOKE ALL ON TABLE rel_mandat2doc_level FROM PUBLIC;
REVOKE ALL ON TABLE rel_mandat2doc_level FROM postgres;
GRANT ALL ON TABLE rel_mandat2doc_level TO postgres;


--
-- TOC entry 1916 (class 0 OID 0)
-- Dependencies: 1523
-- Name: reports; Type: ACL; Schema: public; Owner: postgres
--

REVOKE ALL ON TABLE reports FROM PUBLIC;
REVOKE ALL ON TABLE reports FROM postgres;
GRANT ALL ON TABLE reports TO postgres;


-- Completed on 2009-05-27 14:23:38

--
-- PostgreSQL database dump complete
--

